@model SplitEquallyViewModel
@{
    var euroCulture = System.Globalization.CultureInfo.CreateSpecificCulture("nl-NL");
}

<h2>Split the Bill Equally</h2>

<p><strong>Total:</strong> @Model.Bill.OrderTotal.ToString("C", euroCulture)</p>

<form asp-action="SplitEqually" method="post">
    @Html.HiddenFor(m => m.Bill.BillId)

    <div class="form-group">
        <label>Number of People:</label>
        @Html.TextBoxFor(m => m.NumberOfPeople, new { @class = "form-control", @type = "number", @min = "1", @oninput = "updateSplitPreview()" })
        @Html.ValidationMessageFor(m => m.NumberOfPeople)
    </div>

    <div class="form-group">
        <label>Extra Tip (total):</label>
        @Html.TextBoxFor(m => m.ExtraTip, new { @class = "form-control", @type = "number", @step = "0.01", @oninput = "updateSplitPreview()" })
    </div>

    <p id="perPersonDisplay" class="text-info mt-2"></p>

    <button type="submit" class="btn btn-primary">Split & Pay</button>
</form>

<script>
    function updateSplitPreview() {
        const total = @Model.Bill.OrderTotal;
        const people = document.querySelector('input[name="NumberOfPeople"]').value;
        const tip = parseFloat(document.querySelector('input[name="ExtraTip"]').value || 0);

        if (people > 0) {
            const totalPerPerson = (total + tip) / people;
            document.getElementById("perPersonDisplay").innerText = `Each person pays: â‚¬${totalPerPerson.toFixed(2)}`;
        }
    }

    document.addEventListener("DOMContentLoaded", updateSplitPreview);
</script>